<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0"/>
    <title></title>
    <link rel="stylesheet" href="css/index.css" charset="utf-8"/>
    <link rel="stylesheet" href="css/zepto.mtimer.css" charset="UTF-8"/>
</head>
<body>
<div class="container">

    <div id="showList" class="form_text">
        <ul id="msg" class="form_text">

        </ul>
    </div>

    <div class="form_text" >
        <form role="form" id="chat_form" onsubmit="sendMessage(); return false;">
            <ul>
                <li>
                    姓名:
                    <input id = "name" type="text" maxlength="15"/>
                </li>
                <li>
                    电话:
                    <input id = "phone" type="text" maxlength="11"/>
                </li>
                <li>
                    日期:
                    <input id="time" type="text" id="picktime" value="08-29 10:00" readonly/>
                </li>
                <li>
                    <button type="button" id="send" class="btn btn-primary"
                            onclick="sendMessage();">提交</button>
                </li>
            </ul>
        </form>
    </div>
</div>
</body>
<script src="js/zepto.js" charset="UTF-8" type="text/javascript"></script>
<script src="js/zepto.mtimer.js" charset="UTF-8" type="text/javascript"></script>
<script>
    $(function(){

        $('#picktime').mtimer();

    });
</script>

<script>

    //从cookie中设置用户名，或没有则，弹出窗体，设置用户名
    $(function () {
//            初始化div的 滚轴
        var talkArea =document.getElementById('showList');
//            talkArea.scrollTop=0;
        talkArea.scrollTop=talkArea.scrollHeight;

    });


    //        var url='ws://192.168.12.158:8084/ws/';
    var pathName=window.location.pathname;
    var hostName =window.location.host;

    var path=hostName+pathName;
    console.log(path);
    var wsPath="ws://"+path+'ws/user';
    console.log(wsPath);
    var ws= new WebSocket(wsPath);

    function appendLog(type,message) {

        var messages = document.getElementById('msg');
        var li = document.createElement("li");

        var preface_label;

        if(type==='notification') {
            preface_label = "<span class=\"label label-info\">*</span>";
        } else if(type==='nick_update') {
            preface_label = "<span class=\"label label-warning\">*</span>";
        } else {
            preface_label = "<span class=\"label label-success\">" + nickname + "</span>";
        }

        var message_text = "<h2>" + preface_label + "  " + message + "</h2>";
        li.innerHTML = message_text;
        messages.appendChild(li);
    }
    ws.onopen = function (e) {
        /*     var name = $.cookie("Uname");
         ws.send(name);*/
    };
    ws.onmessage = function(e){
        var data = JSON.parse(e.data);
        var type=e.type;

        appendLog(type,data);
    };

    function sendMessage(){

        var name = $('#name').val().trim();
        var phone =$('#phone').val().trim();
        var time = $('#time').val().trim();

        if(name.length<1){
            alert("不能发送空内容！");
            return;
        }
        if(phone.length<1){
            alert("不能发送空内容！");
            return;
        }

        var user={
            name:name,
            phoneNum:phone,
            lat:time,
            cat:time,
            mark:1
        };

        var mStr = JSON.stringify(user);
        ws.send(mStr);

    }
</script>
</html>